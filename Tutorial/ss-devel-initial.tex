%======================================================================
\NEWSEC
%======================================================================

\subsection{\ssDevelInitial}

\begin{frame}[fragile,label=ss-devel-initial] 
\secframetitle{\ssDevelInitial}
\textbf{Suppose we wish to add an implosion test problem to \enzop.}\begin{center}
\rowcolors[]{1}{blue!5}{blue!10}
  \begin{tabular}{l}
  \uncover<2->{\addclass{1.~\textbf{Create \code{EnzoInitialImplosion} class}}} \\
  \uncover<3->{\addclass{2.~Include \code{enzo\_EnzoInitialImplosion.hpp} file}} \\
  \uncover<4->{\addconstruct{3.~Call \code{EnzoInitialImplosion} constructor}} \\
  \uncover<5->{\addparam{4.~Declare any \code{EnzoInitialImplosion} parameters}} \\
  \uncover<6->{\addparam{5.~Read in any \code{EnzoInitialImplosion} parameters}}  \\
  \uncover<7->{\addcharm{6.~Update \charm\ control file \code{enzo.ci}}} \\
  \uncover<8->{\addtest{7.~Create \code{test\_implosion.in} test problem}} \\
  \uncover<9->{\addtest{8.~Run the test and verify test results}}
  \end{tabular}
\end{center}

\end{frame}

%----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{1.~Create an \code{EnzoInitialImplosion} class}

\addclassbf{Create header and source code files}
      \begin{itemize}
      
         \item \textcolor{red!50!black}
             {\code{src/Enzo/enzo\_EnzoInitialImplosion.hpp}}
         \item \textcolor{red!50!black}
             {\code{src/Enzo/enzo\_EnzoInitialImplosion.cpp}}
      \end{itemize}
      \pause
      \bluebf{Implement virtual functions}
      \begin{itemize}
      
          \item \textcolor{blue!50!black}
              {\code{EnzoInitialImplosion::EnzoInitialImplosion} ()}
          \item \textcolor{blue!50!black}
              {\code{EnzoInitialImplosion::enforce\_block} ()}
          \item \textcolor{blue!50!black}
              {\code{EnzoInitialImplosion::pup} ()}
      \end{itemize}
\end{frame}

\definecolor{kcol}{rgb}{0.5,0.0,0.5}
\definecolor{ccol}{rgb}{0.0,0.5,0.0}
\definecolor{mcol}{rgb}{0.8,0.0,0.0}
\definecolor{fcol}{rgb}{0.0,0.0,0.8}
\definecolor{tcol}{rgb}{0.0,0.8,0.0}
\definecolor{vcol}{rgb}{0.8,0.3,0.0}

%----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{1.~Create an \code{EnzoInitialImplosion} class}
\addclassbf{Create the \code{src/Enzo/EnzoInitialImplosion.hpp} header file}
\footnotesize
\begin{tabbing}
xxxxxxx\=xxxxxx\=\kill
\textbf<2>{\code{
\color<1,2>{kcol} class
\color<1,2>{ccol} EnzoInitialImplosion
\color<1,2>{black}:\ \color<1,2>{kcol}public
\color<1,2>{ccol} Initial
\color<1,2>{black}     \{ 
}}  \\
 \\[-2ex]
\code{
\color<1>{kcol} public:
\color<1>{mcol} // interface
} \\
\> \textbf<3>{\code{
\color<1,3>{fcol}  EnzoInitialImplosion 
\color<1,3>{black} ( 
\color<1,3>{tcol}  int
\color<1,3>{black}  * 
\color<1,3>{vcol}  cycle 
\color<1,3>{black}  ,
\color<1,3>{tcol}  double  
\color<1,3>{black}  * 
\color<1,3>{vcol}  time
\color<1,3>{black} );
 }} \\
\> \textbf<4>{\code{
\color<1,4>{kcol} virtual 
\color<1,4>{kcol} void  
\color<1,4>{fcol} enforce\_block
}} \\
\> \> \textbf<4>{\code{
\color<1,4>{black}    ( 
\color<1,4>{tcol}  Block  
\color<1,4>{black}  * 
\color<1,4>{vcol}  block 
\color<1,4>{black}  ,
}} \\
\> \> \textbf<4>{\code{
\color<1,4>{tcol}  \ \ const FieldDescr
\color<1,4>{black}  * 
\color<1,4>{vcol}  field\_descr
\color<1,4>{black}  , 
}} \\
\> \> \textbf<4>{\code{
\color<1,4>{tcol}  \ \ const Hierarchy
\color<1,4>{black}  * 
\color<1,4>{vcol}  hierarchy
\color<1,4>{black}   )  
\color<1,4>{kcol}    throw 
\color<1,4>{black}    ();
}} \\
\> \textbf<5>{\code{
\color<1,5>{fcol}EnzoInitialImplosion
\color<1,5>{black} () \{\};
}} \\
\> \textbf<5>{\code{
\color<1,5>{fcol} EnzoInitialImplosion
\color<1,5>{black} (
\color<1,5>{tcol} CkMigrateMessage
\color<1,5>{black}  *
\color<1,5>{vcol} m
\color<1,5>{black} ) \{\}
}} \\
\> \textbf<5>{\code{
\color<1,5>{fcol}PUPable\_decl\color<1,5>{black}(\color<1,5>{tcol}EnzoInitialImplosion\color<1,5>{black} );
}} \\
\> \textbf<5>{\code{
\color<1,5>{kcol} void
\color<1,5>{fcol} pup
\color<1,5>{black} (
\color<1,5>{tcol}PUP::er 
\color<1,5>{black}\&
\color<1,5>{vcol}p
\color<1,5>{black} )
}}
 \\
\> \textbf<5>{\code{
\color<1,5>{black} \{ 
\color<1,5>{tcol}Initial\color<1,5>{black}::pup(
\color<1,5>{vcol}p
\color<1,5>{black} ); 
\color<1,5>{black} \};
}} \\
\ \code{\}}
\end{tabbing}
\end{frame}

%-----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{1.~Create an \code{EnzoInitialImplosion} class}
\addclassbf{Implement the \code{EnzoInitialImplosion::enforce\_block()} method}
\scriptsize
\begin{semiverbatim}
\keyword{void} \type{EnzoInitialImplosion}::\function{enforce_block} 
(
 \type{Block} * \variable{block},
 \keyword{const} \type{FieldDescr} * \variable{field_descr},
 \keyword{const} \type{Hierarchy}  * \variable{hierarchy}
 ) \keyword{throw}()
\{
   \type{Field} \variable{field} = \variable{block}->\function{data}()->\function{field}();

   \type{enzo_float} *  \variable{d} = (\type{enzo_float} *) \variable{field}.\function{values}(\valuetext{"density"});
   \type{enzo_float} * \variable{vx} = (\type{enzo_float} *) \variable{field}.\function{values}(\valuetext{"velocity_x}");
   \type{enzo_float} * \variable{vy} = (\type{enzo_float} *) \variable{field}.\function{values}(\valuetext{"velocity_y}");
   \type{enzo_float} * \variable{te} = (\type{enzo_float} *) \variable{field}.\function{values}(\valuetext{"total_energy}");
      \vdots
\end{semiverbatim}
\end{frame}

%-----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{1.~Create an \code{EnzoInitialImplosion} class}
\addclassbf{Implement the \code{EnzoInitialImplosion::enforce\_block()} method}
\scriptsize
\begin{semiverbatim}
      \vdots
  \comment{// Field attributes}
  \type{int} \variable{mx},\variable{my},\variable{nx},\variable{ny},\variable{gx},\variable{gy};     
  \variable{field}.\function{dimensions}  (\valuetext{0},&\variable{mx},&\variable{my});
  \variable{field}.\function{size}          (&\variable{nx},&\variable{ny});
  \variable{field}.\function{ghost_depth} (\valuetext{0},&\variable{gx},&\variable{gy});

  \comment{// Cell widths}
  \type{double} \variable{xm},\variable{ym},\variable{xp},\variable{yp},\variable{hx},\variable{hy};
  \variable{block}->\function{data}()->\function{lower}(&\variable{xm},&\variable{ym});
  \variable{block}->\function{data}()->\function{upper}(&\variable{xp},&\variable{yp});
  \variable{field}.\function{cell_width}(\variable{xm},\variable{xp},&\variable{hx},\variable{ym},\variable{yp},&\variable{hy});
      \vdots
\end{semiverbatim}
\end{frame}

%-----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{1.~Create an \code{EnzoInitialImplosion} class}
\addclassbf{Implement the \code{EnzoInitialImplosion::enforce\_block()} method}
\scriptsize
\begin{semiverbatim}
      \vdots
   \keyword{for} (\type{int} \variable{iy}=\variable{gy}; \variable{iy}<\variable{ny}+\variable{gy}; \variable{iy}++) \{
      \type{double} \variable{y} = \variable{ym} + (\variable{iy} - \variable{gy} + \valuetext{0.5})*\variable{hy};
      \keyword{for} (\type{int} \variable{ix}=\variable{gx}; \variable{ix}<\variable{nx}+\variable{gx}; \variable{ix}++) \{
         \type{double} \variable{x} = \variable{xm} + (\variable{ix} - \variable{gx} + \valuetext{0.5})*\variable{hx};
         \type{int} \variable{i} = \variable{ix} + \variable{mx}*\variable{iy};
         \keyword{if} (\variable{x} + \variable{y} < \valuetext{0.1517}) \{
            \variable{d}[\variable{i}]  = \valuetext{0.125};
            \variable{te}[\variable{i}] = \valuetext{0.14} / ((\type{EnzoBlock}::\variable{Gamma} - \valuetext{1.0}) * \variable{d}[\variable{i}]);
         \} \keyword{else} \{
            \variable{d}[\variable{i}]  = \valuetext{1.0};
            \variable{te}[\variable{i}] = \valuetext{1.0} / ((\type{EnzoBlock}::\variable{Gamma} - \valuetext{1.0}) * \variable{d}[\variable{i}]);
         \}
         \variable{vx}[\variable{i}] = \variable{vy}[\variable{i}] = \valuetext{0.0};
      \}
   \}
\}
\end{semiverbatim}
\end{frame}

%----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{2.~Include the \code{enzo\_EnzoInitialImplosion.hpp} file}

\addclassbf{Update \code{src/Enzo/\_enzo.hpp}}
%
\begin{semiverbatim}
       \vdots
   #include "enzo_EnzoInitialGrackleTest.hpp"
   #\keyword{include} \valuetext{"enzo_EnzoInitialImplosion.hpp"}
   #include "enzo_EnzoInitialSedovArray2.hpp"
   #include "enzo_EnzoInitialSedovArray3.hpp"
   #include "enzo_EnzoInitialTurbulence.hpp"
       \vdots
\end{semiverbatim}


\end{frame}

%----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{3.~Call the \code{EnzoInitialImplosion} constructor}

\addconstructbf{Update \code{src/Enzo/enzo\_EnzoProblem.cpp}}
\footnotesize
\begin{semiverbatim}
   Initial * EnzoProblem::create_initial_ (\dots)
   \{
         \vdots
       \keyword{if} (\variable{type} == \valuetext{"implosion"}) \{
         \variable{initial} = \keyword{new} \type{EnzoInitialImplosion}(\variable{cycle},\variable{time});
       \} else if (type == "sedov_array_2d") \{
         initial = new EnzoInitialSedovArray2(enzo_config);
       \} else if (type == "sedov_array_3d") \{
         initial = new EnzoInitialSedovArray3(enzo_config);
         \vdots
   \}
\end{semiverbatim}

\end{frame}

%----------------------------------------------------------------------

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{4--5.~Handle any parameters}
\addparambf{(No parameters: see section on \hyperlink{ss-devel-parameters}{\underline{adding parameters to \code{Method}s)}}}
\end{frame}

%======================================================================

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{6.~Update the \charm\ control file \code{enzo.ci}}

\addcharmbf{Update \code{src/Enzo/enzo.ci}}
\footnotesize
\begin{semiverbatim}
   module enzo \{
       \vdots
     \type{PUPable} \variable{EnzoInitialImplosion};
     PUPable EnzoInitialSedovArray2;
     PUPable EnzoInitialSedovArray3;
     PUPable EnzoInitialTurbulence;
       \vdots
   \};
\end{semiverbatim}
\end{frame}


%======================================================================

\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{7.~Create a \code{test\_implosion.in} test problem}
\addtestbf{Create \code{input/test\_implosion.in}}
\vspace{-0.15in}
\begin{semiverbatim}
      \vdots
   \group{Initial} \{
      \parameter{type} = [\valuetext{"implosion"}]; 
   \}
      \vdots
\end{semiverbatim}

\end{frame}

%----------------------------------------------------------------------

% \begin{frame}[fragile] 
% \secframetitle{\ssDevelInitial}
% \framesubtitle{Add \code{test\_heat} to the other regression tests}
% 
% \code{test/SConscript}
% 
% \begin{center}
% \begin{minipage}{3.0in}
% \blockblue
% \begin{block}<+->{\textbf{\code{src/Enzo/enzo\_EnzoProblem.cpp}}}
% \footnotesize
% \begin{semiverbatim}
% 
% test/SConscript:# InitialImplosion tests
% test/SConscript:Clean(env\_mv\_out.RunSerial ('test\_initial\_heat-1.unit',bin% \_path + '/enzo-p', 
% test/SConscript:		ARGS='input/initial\_heat-1.in'),
% test/SConscript:      [Glob('#/' + test\_path + '/initial\_heat-1*.png'),
% test/SConscript:       Glob('#/' + test\_path + '/initial\_heat-1*.h5'),
% test/SConscript:        '#/input/initial\_heat-1.in.out'])
% test/SConscript:env.MakeMovie ("initial\_heat-1.swf", "test\_initial\_heat-1.unit", \
% test/SConscript:                ARGS= test\_path + "/initial\_heat-1*.png");
% test/SConscript:Clean(env\_mv\_out.RunParallel ('test\_initial\_heat-8.unit',bin\_path + '/enzo-p', 
% test/SConscript:		ARGS='input/initial\_heat-8.in'),
% test/SConscript:      [Glob('#/' + test\_path + '/initial\_heat-8*.png'),
% test/SConscript:      Glob('#/' + test\_path + '/initial\_heat-8*.h5'),
% test/SConscript:      '#/input/initial\_heat-8.in.out'])
% test/SConscript:env.MakeMovie ("initial\_heat-8.swf", "test\_initial\_heat-8.unit", \
% test/SConscript:                ARGS= test\_path + "/initial\_heat-8-*.png");
% \end{semiverbatim}
% \end{block}
% \end{minipage}
% \end{center}
% \end{frame}

%----------------------------------------------------------------------

% \begin{frame}[fragile] 
% \secframetitle{\ssDevelInitial}
% \framesubtitle{Display the \code{test\_heat} test results in \code{index.php}}
     
% \code{test/index.php}


% \begin{center}
% \begin{minipage}{3.0in}
% \blockblue
% \begin{block}<+->{\textbf{\code{src/Enzo/enzo\_EnzoProblem.cpp}}}
% \footnotesize
% \begin{semiverbatim}
% test/index.php:test\_summary("Initial-heat",
% test/index.php:	     array("initial\_heat-1",
% test/index.php:		   "initial\_heat-8"),
% test/index.php:test\_group("Initial-heat");
% test/index.php:Initial-heat tests serve to test basic functionality of the "heat" initial
% test/index.php:  echo "<h3>HEAT (serial) </h3>";
% test/index.php:tests("Enzo","enzo-p","test\_initial\_heat-1","HEAT 1 block");
% test/index.php:test\_table ("initial\_heat-1",
% test/index.php:  echo "<h3>HEAT (parallel) </h3>";
% test/index.php:tests("Enzo","enzo-p","test\_initial\_heat-8","HEAT 8 block");
% test/index.php:test\_table ("initial\_heat-8",
% \end{semiverbatim}
% \end{block}
% \end{minipage}
% \end{center}
% \end{frame}

%----------------------------------------------------------------------


\begin{frame}[fragile] 
\secframetitle{\ssDevelInitial}
\framesubtitle{8.~Run the test and verify test results}
%     Call test problem in \code{test/}
\begin{center}
  \ANIMATEGRAPHICS{controls,width=2.0in}{20}{Images/Implosion/d-0}{000}{200}
\end{center}
\end{frame}

